<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">
<meta name="keyword" content="">

    <link rel="shortcut icon" href="/mongo-nodejs-driver/2.0/img/favicon.png">

    <title>Upgrading to 2.0</title>

    <link rel="stylesheet" href="/mongo-nodejs-driver/2.0/lib/bootstrap.css" type="text/css" />
<link rel="stylesheet" href="/mongo-nodejs-driver/2.0/lib/font-awesome/css/font-awesome.min.css" type="text/css" />
<link rel="stylesheet" href="/mongo-nodejs-driver/2.0/css/mongodb-docs.css" type="text/css" />
<link rel="stylesheet" href="/mongo-nodejs-driver/2.0/css/overrides.css" type="text/css" />
<link rel="stylesheet" href="/mongo-nodejs-driver/2.0/lib/highlight/styles/idea.css" />
<link rel="stylesheet" href="/mongo-nodejs-driver/2.0/lib/bootstrap-toggle/bootstrap-toggle.min.css" type="text/css" />
<link rel="stylesheet" href="/mongo-nodejs-driver/2.0/css/java.css" type="text/css" />


  </head>

  <body>
  
  <section id="container" class="">
      
      <header id="header-db" class="row" role="navigation">
  <div class="header-content">
    <div class="toggle-nav pull-left">
        <i class="fa fa-bars"></i>
        <div class="icon-reorder tooltips" data-original-title="Toggle Navigation" data-placement="bottom"></div>
    </div>
    
    <div class="logo pull-left">
      <a href="/mongo-nodejs-driver/2.0/../">
        <img src="/mongo-nodejs-driver/2.0/img/logo-mongodb-header.png", alt="MongoDB.org" />
      </a>
    </div>
    
    <div>
<div class="nav-items pull-right">
  <a href="https://university.mongodb.com" data-toggle="tooltip" data-placement="bottom" title="Free Online Classes">MongoDB University</a>
  <a href="http://www.mongodb.org/downloads" data-toggle="tooltip" data-placement="bottom" title="Download MongoDB">Downloads</a>
  <a href="http://www.mongodb.org/get-involved" data-toggle="tooltip" data-placement="bottom" title="Get involved with MongoDB">Community</a>
  <a href="http://docs.mongodb.org" data-toggle="tooltip" data-placement="bottom" title="The MongoDB Documentation">Docs</a>
  <a href="http://blog.mongodb.org" data-toggle="tooltip" data-placement="bottom" title="The MongoDB Blog">Blog</a>
  <div id="search">
<form method="get" action="//www.google.com/search" target="_blank">
    <input type="text" name="searchQuery" size="20" value="" autocomplete="off" placeholder="Search docs">
    <input type="hidden" name="site" value="/mongo-nodejs-driver/2.0">
    <input type="hidden" name="q" value="">
    <label for="searchQuery"><i class="fa fa-search fa-1"></i></label>
</form>
</div>

</div>
</div>

  </div>
</header>

      

      
<aside id="sidebar" class="sidebar">
    <div class="ssidebar nav-collapse">
      <div class="ssidebarwrapper">
        <h3>
          <a class="index-link" href="/mongo-nodejs-driver/2.0/../">MongoDB Node.js Driver</a>
          <a class="version pull-right" href="/mongo-nodejs-driver/2.0">2.0</a>
        </h3>

        
        <ul class="sidebar-menu">
          
          
          
          
          
          
          
          
          
          
          
          

          
          
            
            









  
    
    
      
      
        
        
        
        
        
        
        
        









  
  
  
  
  
  
  
  

  
    
    
    
  
  


        
      
    
    
  


          
            
            









  
    
    
      
      
    
      
      
    
    
  


          
            
            









  
    
    
      
      
    
      
      
    
      
      
    
      
      
    
    
  


          
            
            









  


          
            
            









  


          
            
            









  


          
            
            









  


          

          

          
            
            













  




<li class="toctree-l1  current">
  <a href="/mongo-nodejs-driver/2.0/whats-new/" class="">
      <i class='fa fa-cog'></i>
      <span>What&#39;s New</span>
      <span class="menu-arrow fa fa-angle-down"></span>
  </a>
    <ul  class="current">
        
        
        
        













  




    <li class="toctree-l2">
    <a href="/mongo-nodejs-driver/2.0/whats-new/upgrading/">
        <i class='fa fa-wrench'></i>
        Upgrading to 2.0
    </a>
  </li>


        
        
    </ul>
  </li>


          
            
            
















<li class="toctree-l1 ">
  <a href="/mongo-nodejs-driver/2.0/getting-started/" class="">
      <i class='fa fa-road'></i>
      <span>Getting Started</span>
      <span class="menu-arrow fa fa-angle-right"></span>
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongo-nodejs-driver/2.0/getting-started/installation-guide/">
        <i class='fa'></i>
        Installation Guide
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongo-nodejs-driver/2.0/getting-started/quick-tour/">
        <i class='fa'></i>
        Quick Tour
    </a>
  </li>


        
        
    </ul>
  </li>


          
            
            
















<li class="toctree-l1 ">
  <a href="/mongo-nodejs-driver/2.0/reference/" class="">
      <i class='fa fa-book'></i>
      <span>Reference</span>
      <span class="menu-arrow fa fa-angle-right"></span>
  </a>
    <ul >
        
        
        
        
















<li class="toctree-l2 ">
  <a href="/mongo-nodejs-driver/2.0/reference/connecting/" class="">
      <i class='fa'></i>
      <span>Connecting</span>
      
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongo-nodejs-driver/2.0/reference/connecting/connection-settings/">
        <i class='fa'></i>
        Connection Settings
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongo-nodejs-driver/2.0/reference/connecting/ssl/">
        <i class='fa'></i>
        SSL
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongo-nodejs-driver/2.0/reference/connecting/authenticating/">
        <i class='fa'></i>
        Authenticating
    </a>
  </li>


        
        
    </ul>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongo-nodejs-driver/2.0/reference/crud/">
        <i class='fa'></i>
        CRUD Operations
    </a>
  </li>


        
        
        
        
        
















<li class="toctree-l2 ">
  <a href="/mongo-nodejs-driver/2.0/reference/gridfs/" class="">
      <i class='fa'></i>
      <span>GridFS</span>
      
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongo-nodejs-driver/2.0/reference/gridfs/gridstore/">
        <i class='fa'></i>
        GridStore
    </a>
  </li>


        
        
    </ul>
  </li>


        
        
        
        
        
















<li class="toctree-l2 ">
  <a href="/mongo-nodejs-driver/2.0/reference/management/" class="">
      <i class='fa'></i>
      <span>Management</span>
      
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongo-nodejs-driver/2.0/reference/management/logging/">
        <i class='fa'></i>
        Logging
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongo-nodejs-driver/2.0/reference/management/apm/">
        <i class='fa'></i>
        APM
    </a>
  </li>


        
        
    </ul>
  </li>


        
        
    </ul>
  </li>


          
            
            
















    <li class="toctree-l1">
    <a href="/mongo-nodejs-driver/2.0/api/">
        <i class='fa fa-file-text-o'></i>
        API Documentation
    </a>
  </li>


          
            
            
















    <li class="toctree-l1">
    <a href="https://github.com/mongodb/node-mongodb-native">
        <i class='fa fa-github'></i>
        Source Code
    </a>
  </li>


          
            
            
















    <li class="toctree-l1">
    <a href="/mongo-nodejs-driver/2.0/issues-help/">
        <i class='fa fa-life-ring'></i>
        Issues &amp; Help
    </a>
  </li>


          
            
            
















    <li class="toctree-l1">
    <a href="https://gitter.im/mongodb/node-mongodb-native?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge">
        <img src='https://badges.gitter.im/Join Chat.svg'/>
        
    </a>
  </li>


          
        </ul>
        
    </div>
  </div>
  
</aside>

<div class="option-popup closed hidden" id="optionsVersionsPopup">
<div class="option-header">
  <i class="fa fa-gear"></i>
  <span>OPTIONS</span>
  <i class="fa fa-angle-up pull-right"></i>
</div>
<div class="option-body">
  <ul>
      
      <li>
        <label>Version</label>
        <div class="btn-group btn-group-xs pull-right">
          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
            Select Version <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" role="menu" id="optionsVersionsMenu">
          </ul>
        </div>
      </li>

   


    

  </ul>
</div>
</div>



      
      <section id="main-content" class="content">
          <section class="main-column pull-left">
            <div class="document">
              <div class="documentwrapper">
                <div class="bodywrapper">
                  <div class="body">


   
<a class="edit-link" href="https://github.com/mongodb/node-mongodb-native/blob/2.0/docs/reference/content/whats-new/upgrading.md" target="_blank" title="Edit whats-new/upgrading.md on GitHub"><i class="fa fa-pencil-square-o"></i></a>










<div class="bc">
<ul>
  
  
  
  
  
  <li><a href="/mongo-nodejs-driver/2.0/whats-new/">What&#39;s New</a> <i class="fa fa-angle-right"></i></li>
  <li>Upgrading to 2.0</li>
</ul>
</div>




<h1 id="migrating-your-application-to-2-0">Migrating Your Application To 2.0</h1>

<p>There are some key changes in the driver going from 1.X to 2.X that one needs to be aware off before changing your application to using the new 2.X versions. There has been some cleanup of API&rsquo;s and some deprecations of 1.X features.</p>

<h2 id="design-differences-in-2-x">Design differences in 2.X</h2>

<p>One of the main changes is that the driver has been split into two pieces. There is a new <code>mongodb-core</code> that contains the low level MongoDB API&rsquo;s while <code>mongodb</code> contains the high level driver. <code>mongodb-core</code> is targeted to creators of libraries like <code>Mongoose</code> and other ODM&rsquo;s who do not need the abstractions available in the <code>mongodb</code> driver. The driver is also as of the time of writing compatible with the 0.11.x node.js branch including Kerberos support as well as MongoDB 2.8.</p>

<h2 id="changes">Changes</h2>

<p>We will outline where changes have occurred that could break your existing application.</p>

<h3 id="node-js-versions-and-streams">Node.JS versions and Streams</h3>

<p>The 2.0 driver drops support for 0.8.x style streams and moves to 0.10.x or higher style pull based streams making for more reliable and faster streams. Backwards compatibility is by using the <code>readable-stream</code> npm package that might cause some slight behavior changes for the cursor streams.</p>

<p>All dependencies have now been updated to use the <code>nan</code> package meaning they will compile and work on 0.11.x or higher.</p>

<h3 id="grid-object">Grid Object</h3>

<p>The grid object has been removed as it&rsquo;s not widely used and offers very limited GridStore capabilities.</p>

<h3 id="db-object">Db Object</h3>

<p>The db instance object have had several changes made to it. We&rsquo;ve removed the following methods.</p>

<ul>
<li><code>db.dereference</code> due to db references being deprecated in the server.</li>
<li><code>db.cursorInfo</code> removed as it never worked reliably.</li>
<li><code>db.stats</code> removed as inconsistent.</li>
<li><code>db.collectionNames</code> removed as it&rsquo;s just a specialized version of the new <code>listCollections</code> helper.</li>
<li><code>db.collectionInfo</code> removed as it&rsquo;s not compatible with the new MongoDB 2.8 or higher alternative storage enginers.</li>
</ul>

<p>Added the following method</p>

<ul>
<li><code>db.listCollections</code> to replace all other collection inquiry method as it will do the correct thing for MongoDB 2.8 and higher as well as provide backwards compatibility for MongoDB 2.6 or lower.</li>
</ul>

<h3 id="collection-object">Collection Object</h3>

<p>A collection instance has also had several changes made to it. Most importantly we now return the <code>mongodb-core</code> result objects directly with all the associated information returned from the server instead of the current selective information returned in the 1.4.x version.</p>

<p>We&rsquo;ve added the following new methods</p>

<ul>
<li><code>collection.insertOne</code> Insert a single document.</li>
<li><code>collection.insertMany</code> Insert an array of documents.</li>
<li><code>collection.replaceOne</code> Replace an existing document fully.</li>
<li><code>collection.updateOne</code> Update a single document.</li>
<li><code>collection.updateMany</code> Update multiple documents in one go.</li>
<li><code>collection.deleteOne</code> Delete a single document.</li>
<li><code>collection.deleteMany</code> Delete multiple documents in one go.</li>
<li><code>collection.findOneAndUpdate</code> Use findAndModify to update a document.</li>
<li><code>collection.findOneAndDelete</code> Use findAndModify to remove a specific document.</li>
<li><code>collection.findOneAndReplace</code> Use findAndModify to replace a specific document.</li>
</ul>

<p>The current <code>insert</code>, <code>update</code> and <code>remove</code> methods are marked for deprecation and will be removed in a future 3.0 driver. These 3 methods now also return the full <code>mongodb-core</code> results and have had their third return value removed to ensure less compatibility problems with orchestration libraries like <code>async</code>.</p>

<p>The insert methods are now capping at the <code>maxWriteBatchSize</code> passed back from MongoDB on the results from the <code>ismaster</code> command. For MongoDB 2.4 or lower this means a max of 1000 documents in each insert batch. Legacy insert mode has been deprecated in favor of proper emulation of current 2.6 or higher write commands.</p>

<p>Another important change is in how <code>collection.find</code> works. The idea is to chain commands instead of passing them into the <code>find</code> method. It still supports existing behavior from 1.4 so no code should break but the API documentation reflects the new preferred way to use the find to execute queries.</p>

<h3 id="gridstore">GridStore</h3>

<p>The GridStore object has had some major changes due to issues discovered by users related to parallel writing using the previous available <code>w+</code> append mode. Thus <code>w+</code> in 2.0 only allows for changes to the file metadata and does not allow for appending to a file avoiding the possible data corruption. The hope is to create a new GridStore spec in the future that allows for proper handling parallel writing to an existing file but this requires changes for all drivers as well as the server.</p>

<h3 id="mongoclient">MongoClient</h3>

<p>MongoClient now only has the class method <code>connect</code>. Constructing of a new MongoClient using <code>Server</code>, <code>ReplSet</code> or <code>Mongos</code> has been removed due to the confusion it caused in duplicating the way one can build a topology connection using <code>Db</code> in 1.4. <code>MongoClient.connect</code> is the recommended way to connect to a MongoDB topology.</p>






<div id="btnv">
  
  
</div>
</div>


</div>
<div class="right-column">
<div class="wrapper">
  
  <div class="toc">
    <span class="toc-header">On this page</span>
    <nav id="TableOfContents">
<ul>
<li><a href="#migrating-your-application-to-2-0">Migrating Your Application To 2.0</a>
<ul>
<li><a href="#design-differences-in-2-x">Design differences in 2.X</a></li>
<li><a href="#changes">Changes</a>
<ul>
<li><a href="#node-js-versions-and-streams">Node.JS versions and Streams</a></li>
<li><a href="#grid-object">Grid Object</a></li>
<li><a href="#db-object">Db Object</a></li>
<li><a href="#collection-object">Collection Object</a></li>
<li><a href="#gridstore">GridStore</a></li>
<li><a href="#mongoclient">MongoClient</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
  </div>
  
</div>
</div>

</div>
</div>
</div>
</section>
</section>

</section>


<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
   URL_ROOT:    "/mongo-nodejs-driver/2.0",
   VERSION:     "2.0",
   COLLAPSE_INDEX: false,
   FILE_SUFFIX: '.html',
   HAS_SOURCE:  true
  };
</script>
<script type="text/javascript" src="/mongo-nodejs-driver/2.0/js/jquery.js"></script>
<script type="text/javascript" src="/mongo-nodejs-driver/2.0/lib/bootstrap.js"></script>
<script type="text/javascript" src="/mongo-nodejs-driver/2.0/js/navbar.js"></script>
<script type="text/javascript" src="/mongo-nodejs-driver/2.0/lib/highlight/highlight.pack.js"></script>
<script type="text/javascript" src="/mongo-nodejs-driver/2.0/js/scripts.js"></script>
<script type="text/javascript" src="/mongo-nodejs-driver/2.0/lib/bootstrap-toggle/bootstrap-toggle.min.js"></script>
<script type="text/javascript" src="/mongo-nodejs-driver/2.0/js/java.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-29229787-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>

